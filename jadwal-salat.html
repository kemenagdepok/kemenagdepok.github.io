<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Salat Bulanan - Kemenag Kota Depok</title>
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* Gaya khusus untuk Halaman Jadwal Bulanan */
        .schedule-controls-wrapper {
            /* Wadah baru untuk menengahkan kontrol */
            display: flex;
            justify-content: center; /* Rata tengah horizontal */
            align-items: center;
            margin-bottom: 25px;
        }
        .schedule-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .schedule-controls select {
            padding: 8px 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
        }
        #load-schedule-btn {
            padding: 8px 15px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        #load-schedule-btn:hover {
            background-color: var(--primary-dark);
        }
        
        /* Gaya untuk Tabel */
        .schedule-table-wrapper {
            overflow-x: auto;
            margin-top: 20px;
        }
        .schedule-table {
            width: 100%;
            min-width: 900px;
            border-collapse: collapse;
            font-size: 0.9rem;
            text-align: center;
        }
        .schedule-table thead th {
            background-color: var(--primary);
            color: var(--white);
            padding: 12px 5px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .schedule-table th, .schedule-table td {
            padding: 10px 5px;
            border: 1px solid #eee;
        }
        .schedule-table tr:nth-child(even) {
            background-color: var(--kemenag-gray);
        }
        .schedule-table td:first-child {
            font-weight: bold;
            color: var(--primary-dark);
            text-align: left;
            padding-left: 15px;
            white-space: nowrap; /* Mencegah tanggal terpotong */
        }
        .today-row {
            background-color: #ffe0b2 !important; /* Highlight Baris Hari Ini */
            font-weight: bold;
            color: #000;
        }
        
        /* Sumber Data */
        .data-source {
            text-align: right;
            margin-top: 15px;
            font-size: 0.8rem;
            color: #666;
            padding-right: 15px;
        }
        
        /* Fix Table Header Text */
        .schedule-table th:nth-child(1) { width: 180px; } /* Lebarkan kolom Tanggal */
    </style>
</head>
<body>

    <header id="header-placeholder"></header>

    <main>
        <div class="breadcrumb-container">
            <a href="index.html">Beranda</a>
            <svg class="breadcrumb-separator" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            <span class="breadcrumb-current">Jadwal Salat Bulanan</span>
        </div>
        <h3 class="section-title">Jadwal Salat Kota Depok</h3>
        
        <div class="card wide" style="margin-bottom: 20px;">
            <p style="margin-bottom: 15px;">Jadwal Salat Bulanan untuk Kota Depok. Pilih periode di bawah untuk menampilkan data:</p>
            
            <div class="schedule-controls-wrapper">
                <div class="schedule-controls">
                    <select id="month-selector"></select>
                    <select id="year-selector"></select>
                    <button id="load-schedule-btn">Tampilkan Jadwal</button>
                </div>
            </div>
            
            <p id="loading-status" style="color:var(--primary); margin-top: 10px; font-weight: 600;"></p>
        </div>

        <div class="schedule-table-wrapper">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Imsak</th>
                        <th>Subuh</th>
                        <th>Terbit</th>
                        <th>Dhuha</th>
                        <th>Zuhur</th>
                        <th>Asar</th>
                        <th>Magrib</th>
                        <th>Isya</th>
                    </tr>
                </thead>
                <tbody id="monthly-schedule-body">
                    <tr>
                        <td colspan="9" style="text-align: center;">Pilih bulan dan tahun di atas, lalu klik Tampilkan Jadwal.</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="data-source">
            Sumber: <a href="https://bimasislam.kemenag.go.id" target="_blank" style="color:var(--primary);">https://bimasislam.kemenag.go.id</a>
        </div>
    </main>

    <footer id="footer-placeholder"></footer>
    <script src="script.js"></script>
    <script>
        
        const CITY_ID = "1225";
        const monthlyScheduleBody = document.getElementById('monthly-schedule-body');
        const monthSelector = document.getElementById('month-selector');
        const yearSelector = document.getElementById('year-selector');
        const loadButton = document.getElementById('load-schedule-btn');
        const loadingStatus = document.getElementById('loading-status');
        
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth() + 1;
        const currentDay = today.getDate();

        // Fungsi untuk format tanggal Indonesia standar: "Senin, 1 Desember 2025"
        function formatFullIndonesianDate(dateString) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', options);
        }

        // 1. Inisialisasi Dropdown Bulan dan Tahun
        function initializeControls() {
            // Bulan
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            monthNames.forEach((name, index) => {
                const monthValue = String(index + 1).padStart(2, '0');
                const option = new Option(name, monthValue);
                if ((index + 1) === currentMonth) {
                    option.selected = true;
                }
                monthSelector.add(option);
            });

            // Tahun (Mulai dari 3 tahun ke belakang hingga 3 tahun ke depan)
            for (let year = currentYear - 3; year <= currentYear + 3; year++) {
                const option = new Option(year, year);
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelector.add(option);
            }
        }

        // 2. Fungsi Utama untuk Mengambil Data
        async function loadMonthlySchedule() {
            const year = yearSelector.value;
            const month = monthSelector.value;
            const api_url = `https://api.myquran.com/v2/sholat/jadwal/${CITY_ID}/${year}/${month}`;
            
            monthlyScheduleBody.innerHTML = `<tr><td colspan="9" style="text-align: center;">Memuat data...</td></tr>`;
            loadingStatus.textContent = `Memuat jadwal untuk ${monthSelector.options[monthSelector.selectedIndex].text} ${year}...`;

            try {
                const response = await fetch(api_url);
                const data = await response.json();

                if (data.status && data.data && data.data.jadwal) {
                    renderSchedule(data.data.jadwal, year, month);
                    loadingStatus.textContent = `Jadwal Salat Bulan ${monthSelector.options[monthSelector.selectedIndex].text} ${year}`;
                } else {
                    throw new Error("Data jadwal salat tidak tersedia untuk periode ini.");
                }
            } catch (error) {
                monthlyScheduleBody.innerHTML = `<tr><td colspan="9" style="color: red; text-align: center;">Gagal memuat jadwal: ${error.message}</td></tr>`;
                loadingStatus.textContent = `Gagal memuat jadwal.`;
            }
        }

        // 3. Fungsi Render Tabel
        function renderSchedule(jadwalArray, selectedYear, selectedMonth) {
            let htmlContent = '';
            
            jadwalArray.forEach(day => {
                const dayDate = new Date(day.date);
                // Cek apakah ini hari ini untuk highlight
                const isToday = dayDate.getDate() === currentDay && dayDate.getMonth() + 1 === currentMonth && dayDate.getFullYear() === currentYear;
                const rowClass = isToday ? 'today-row' : '';

                // Format tanggal ke Bahasa Indonesia standar: "Senin, 1 Desember 2025"
                const formattedDate = formatFullIndonesianDate(day.date); 
                
                htmlContent += `
                    <tr class="${rowClass}">
                        <td>${formattedDate}</td>
                        <td>${day.imsak}</td>
                        <td>${day.subuh}</td>
                        <td>${day.terbit}</td>
                        <td>${day.dhuha}</td>
                        <td>${day.dzuhur}</td>
                        <td>${day.ashar}</td>
                        <td>${day.maghrib}</td>
                        <td>${day.isya}</td>
                    </tr>
                `;
            });
            monthlyScheduleBody.innerHTML = htmlContent;
        }

        // 4. Attach Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeControls();
            
            // Atur event listener ke tombol
            loadButton.addEventListener('click', loadMonthlySchedule);
            
            // Muat jadwal untuk bulan ini secara otomatis saat halaman pertama dimuat
            loadMonthlySchedule(); 
        });
    </script>
</body>
</html>